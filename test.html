<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=0.5">

	<link rel="stylesheet" 
   	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
	integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	crossorigin="anonymous">

	<style>
	@import url('https://fonts.googleapis.com/css?family=Raleway|Roboto:100,400');

	html, body, .container {
		height: 100%;
	}

	line {
		stroke: black;
		stroke-width: 2;
		opacity: 0.5;
	}

	.desc {
		text-transform: uppercase;
		font-family: 'Roboto', sans-serif;
		font-size: 30px;
		font-weight: 100;
		letter-spacing: 6px;
		opacity: 0.75;
	}

	.menu-div {
		padding: 0px;
		margin: 0px;
		width: 100%;
		height: 100%;
	}

	svg {
		display: table;
		margin: 0 auto;
	}
	
	.node-desc {
		font-family: 'Raleway';
		font-size: 22px;
	}

	</style>
</head>
<body>
	<div class='row menu-div'></div>

		<script>

		var active = -1;

		var removeCircles = function(button) {
			button.select('.filler')
				.transition().duration(200)
				.attr('r', radius*0.90)
				.remove()	
			button.select('.outer')
				.transition().duration(200)
				.attr('r', radius*0.90)
				.remove()	
		}

		var addCircles = function(button) {
			button.append('circle')
				.moveToBack()
				.attr('class', 'filler')
				.style('fill', '#ffffff')
				.attr('r', radius*0.95)
				.transition().duration(200)
				.attr('r', radius*1.10)
			button.append('circle')
				.moveToBack()
				.attr('class', 'outer')
				.style('fill', function(d, i) {
					return d.color;
				})
				.attr('r', radius*0.95)
				.transition().duration(200)
				.attr('r', radius*1.20)
		}

		var addDesc = function(text) {
			d3.select('.desc').text(text)
		}

		var removeDesc = function() {
			d3.select('.desc').text('')
		}

		var hoverEnter = function(d, i) {
			if(active != i) {
				addCircles(d3.select(this));
				if(active == -1) {
					addDesc(d.name);
				}
			}
		}
		var hoverLeave = function(d, i) {
			if(active != i) {
				removeCircles(d3.select(this));
				if(active == -1)
					removeDesc();
			}
		}

		var buttonClick = function(d, i) {
			var g = d3.select(this);
			if(active == -1) {
				active = i;
				moveButton(g, d, i)
				updateContent(d, i);
			} else {
				if(active == i) {
					active = -1;
					removeDesc();
					removeCircles(g);
					resetButton(g, d, i)
					return;
				} else {
					moveButton(g, d, i)
					resetButton(d3.select('#btn' + active), d, active)
					removeCircles(d3.select('#btn' + active));
					addDesc(d.name);
					active = i;
				}
			}
		}

		// https://github.com/wbkd/d3-extended
		d3.selection.prototype.moveToBack = function() {  
			return this.each(function() { 
				var firstChild = this.parentNode.firstChild; 
				if (firstChild) { 
					this.parentNode.insertBefore(this, firstChild); 
				} 
			});
		}
	</script>
	
	<script>
		
		var moveEase = d3.easeElastic.amplitude(1.20).period(0.45);
		var extra = 30;

		var moveButton = function(button, d, i) {
			button
				.transition().duration(600)
				.ease(moveEase)
				.attr('transform', 'translate(' + width/2 + ',' + height/2 + ')')

			button.selectAll('circle')
				.transition().duration(300)
				.attr('r', function(d, i) {
					return parseInt(d3.select(this).attr('r')) + extra	
				})
			button.select('image')
				.transition().duration(300)
				.attr("width", (radius+extra)*2 - 23-extra)
				.attr("height", (radius+extra)*2 - 23-extra)
				.attr("x", -(radius+extra)+11+extra/2)
				.attr("y", -(radius+extra)+11+extra/2)
		}
		var resetButton = function(button, d, i) {
			button
				.transition().duration(600)
				.ease(moveEase)
				.attr("transform", "translate(" 
						+ (((radius*2 + gap)*i)+radius+6+paddingX) + "," 
						+ (radius+6+paddingY) + ")"
				)
			button.selectAll('circle')
				.transition().duration(300)
				.attr('r', radius)
			button.select('image')
				.transition().duration(300)
				.attr("width", radius*2 - 23)
				.attr("height", radius*2 - 23)
				.attr("x", -radius+11)
				.attr("y", -radius+11)
		}
		</script>

		

	<script>

		var data = [
			{name: 'Programming', color: '#EC644B', icon: 'code',
				buttons: [
					{name: 'Astronomy', color: '#FFCC80', icon: 'transport'},
					{name: 'Astronomy', color: '#FFCC80', icon: 'transport'},
					{name: 'Astronomy', color: '#FFCC80', icon: 'transport'}
			]},
			{name: 'Photography', color: '#86E2D5', icon: 'technology-1'},
			{name: 'Music', color: '#66CC99', icon: 'drum-set-cartoon-variant'},
			{name: 'Astronomy', color: '#FFCC80', icon: 'transport'},
			{name: 'Contact', color: '#AED581', icon: 'social'},
			{name: 'Resume', color: '#BE90D4', icon: 'paper'}
		];

		//size and margin
		width = parseInt(d3.select('.menu-div').style('width')) - 5;
		height = parseInt(d3.select('.menu-div').style('height')) - 5;

		// main canvas
		var canvas = d3.select('.menu-div')
		    .append('svg')
		    .attr('width', width)
		    .attr('height', height)

		var content = canvas.append('g')
			.attr('class', 'content')


		var radius = 30,
			gap = 45,
			paddingX = (width - (radius*6*2 + gap*5))/2,
			paddingY = (height - 150);

		var menu = canvas.append('g')
			.attr('class', 'menu')
			.style('opacity', 0.75)
		    //.attr("transform", "translate(" + paddingX + "," + paddingY + ")")	

		menu.append("text")
			.attr("class", "desc")
			.attr("x", (radius*6*2 + gap*5)/2)
			.attr("y", radius*3+12)
			.style("text-anchor", "middle")
			.text('')
		    .attr("transform", "translate(" + paddingX + "," + paddingY + ")")	

		var button = menu.selectAll('.button')
			.data(data)
			.enter()
			.append('g')
			.attr('class', 'button')
			.attr('id', function(d, i) {
				return 'btn' + i;
			})
			.style('opacity', 0)
			.attr("transform", function(d, i) {
				return "translate(" 
					+ (((radius*2 + gap)*i)+radius+6+paddingX) + "," 
					+ ((radius*3)+6+paddingY) + ")"
			});

		button
			.append('circle')
			.attr('r', radius)
			.attr('fill', function(d, i) {
				return d.color;
			});

		button
			.append("svg:image")
			.attr("xlink:href", function(d, i) {
				return "svg/" + d.icon + ".svg";
			})
			.attr("width", radius*2 - 23)
			.attr("height", radius*2 - 23)
			.attr("x", -radius+11)
		  	.attr("y", -radius+11);

		button
			.on("mouseenter", hoverEnter)
			.on("mouseleave", hoverLeave)	
			.on("click", buttonClick)

		button
			.transition()
			.delay( function(d, i) {
				return 1000 + 100*i;
			})
			.duration(1200)
			.ease(d3.easeElastic)
			.style('opacity', 1)
			.attr("transform", function(d, i) {
				return "translate(" 
					+ (((radius*2 + gap)*i)+radius+6+paddingX) + "," 
					+ (radius+6+paddingY) + ")"
			});

	</script>
	<script>

		//var updateContent = function(d, i) {

			var simulation = d3.forceSimulation()
				.alphaDecay(0.012)
				.force("positioningX", d3.forceX()
					.x(function(d, i) { return 250*i; })
				)
				.force("positioningY", d3.forceY()
					.y(function(d, i) { return 100*i; })
				)
				//.force("charge",d3.forceManyBody())

			simulation
				.nodes(data[0].buttons)
			  	.on("tick", tick);	

			var box = d3.select('.content')
				.selectAll('rect')
				.data(data[0].buttons)
				.enter()
				.append('rect')
				.attr('width', 200)
				.attr('height', 100)
		//		.attr('x', getRandX)
		//		.attr('y', function(d, i) { return 100*i })
				.call(d3.drag()
					.on("start", dragstarted)
					.on("drag", dragged)
					.on("end", dragended))


			function tick() {
				console.log('tick');
				
				box
				.attr('x', function(d) { return d.x; })
				.attr('y', function(d) { return d.y; })

			}				

			function dragstarted(d) {
				if (!d3.event.active) simulation.alphaTarget(0.3).restart();
				d.fx = d.x;
				d.fy = d.y;
			}

			function dragged(d) {
				d.fx = d3.event.x;
				d.fy = d3.event.y;
			}

			function dragended(d) {
				if (!d3.event.active) simulation.alphaTarget(0);
				if(!d.fixed) {
					d.fx = null;
					d.fy = null;
				}
			}
		//}

		/*var getRandX = function() {
			r = getRandomInt(1,1000);
			if(r%2 == 0) {
				return getRandomInt(30, (width/2)-radius-extra);
			} else {
				return getRandomInt((width/2)+radius+extra, width);
			}
		}*/


		function getRandomInt(min, max) {
			min = Math.ceil(min);
			max = Math.floor(max);
			return Math.floor(Math.random() * (max - min)) + min;
		}
		
	</script>
<!--	
	<script>

		nodes = [
			{name: 'programming', fixed: true, fx: 250, fy: height/2.5},
			{name: 'github', x: width/2, y: height/2},
			{name: 'hackerrank', x: width/2, y: height/2},
			{name: 'projects', x: width/2, y: height/2}
		]

		links = [
			{source: 'programming', target: 'github'},
			{source: 'programming', target: 'hackerrank'},
			{source: 'programming', target: 'projects'},
		]

		var many_body_force = d3.forceManyBody()
			.strength( function(d, i) {
				return -30
			})

		var link_force = d3.forceLink()
			.id( function(d) { return d.name })
			.distance(150)
			
		var simulation = d3.forceSimulation()
			.force("center", d3.forceCenter(width / 2, height / 2.5).x(
				function(d,i) { return 250;}))
//			.force('positioning', d3.forceY(-0.2))
			.force("charge",many_body_force)
//			.force("link",link_force);

		simulation
		  .nodes(nodes)
	      .on("tick", tick);

//		simulation.force("link")
//		  .links(links);

		var content = canvas.append('g')
			.attr('class', 'content')

		var node = content.selectAll('.node')
			.data(nodes)
			.enter()
			.append('g')

		node.append('circle')
			.attr('class', 'node')
			.attr('r', function(d, i) {
				if(d.fixed)
					return 5;
				else
					return radius;	
			})
			.call(d3.drag()
				.on("start", dragstarted)
				.on("drag", dragged)
				.on("end", dragended))
		
		node.append('text')
			.attr('class', 'node-desc')
			.style('fill', 'red')
			.text( function(d, i) {
				if(!d.fixed)
					return d.name
			})

		var link = content.selectAll('.link')
			.data(links)
			.enter()
			.append('line')
			.attr('class', 'link')
			

		function tick() {
/*			link
				.attr("x1", function(d) { return d.source.x; })
				.attr("y1", function(d) { return d.source.y; })
				.attr("x2", function(d) { return d.target.x; })
				.attr("y2", function(d) { return d.target.y; });
*/
			node.attr('transform', function(d, i) {
				return 'translate(' + d.x + ',' + d.y + ')';
			})
			node.select('.node-desc')
				.attr('text-anchor', function(d, i) {
					if(d.x <= width/2)
						return 'end'
					else
						return 'start'
				})
		}

		function dragstarted(d) {
			if (!d3.event.active) simulation.alphaTarget(0.3).restart();
			d.fx = d.x;
			d.fy = d.y;
		}

		function dragged(d) {
			d.fx = d3.event.x;
			d.fy = d3.event.y;
		}

		function dragended(d) {
			if (!d3.event.active) simulation.alphaTarget(0);
			if(!d.fixed) {
				d.fx = null;
				d.fy = null;
			}
		}
				

	</script>
-->


</body>
</html>
