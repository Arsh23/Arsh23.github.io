<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<style>
	line {
		stroke: black;
		stroke-width: 2;
		opacity: 0.5;
	}
	</style>
</head>
<body>
    <div class='graph'></div>
	<script>

		var active = -1;

		var removeCircles = function(button) {
			console.log('remove')
			button.select('.filler')
				.transition().duration(200)
				.attr('r', radius*0.90)
				.remove()	
			button.select('.outer')
				.transition().duration(200)
				.attr('r', radius*0.90)
				.remove()	
		}

		var addCircles = function(button) {
			button.append('circle')
				.moveToBack()
				.attr('class', 'filler')
				.style('fill', '#ffffff')
				.attr('r', radius*0.95)
				.transition().duration(200)
				.attr('r', radius*1.10)
			button.append('circle')
				.moveToBack()
				.attr('class', 'outer')
				.style('fill', function(d, i) {
					return d.color;
				})
				.attr('r', radius*0.95)
				.transition().duration(200)
				.attr('r', radius*1.20)
		}

		var hoverEnter = function(d, i) {
			if(active != i) {
				addCircles(d3.select(this));
			}
		}
		var hoverLeave = function(d, i) {
			if(active != i) {
				removeCircles(d3.select(this));
			}
		}

		var drawLines = function(x, y) {
			canvas.append('line')
				.attr('x1', x-15).attr('y1', y-radius-5)
				.attr('x2', x-25).attr('y2', y-radius-15)
			canvas.append('line')
				.attr('x1', x+15).attr('y1', y-radius-5)
				.attr('x2', x+25).attr('y2', y-radius-15)

			canvas.append('line')
				.attr('x1', x-25).attr('y1', y-radius-15)
				.attr('x2', 0 + 20).attr('y2', y-radius-15)
			canvas.append('line')
				.attr('x1', x+25).attr('y1', y-radius-15)
				.attr('x2', width-20).attr('y2', y-radius-15)
				
			canvas.append('line')
				.attr('x1', 0+20).attr('y1', y-radius-15)
				.attr('x2', 0+10).attr('y2', y-radius-25)
			canvas.append('line')
				.attr('x1', width-20).attr('y1', y-radius-15)
				.attr('x2', width-10).attr('y2', y-radius-25)
		}

		var buttonClick = function(d, i) {
			var g = d3.select(this);
			if(active == -1) {
				active = i;
			} else {
				if(active == i) {
					active = -1;
					removeCircles(g);
					return;
				} else {
					d3.selectAll('line').remove()
					removeCircles(d3.select('#btn' + active));
					active = i;
				}
			}
			var x = parseInt(g.attr("transform").split('(')[1].split(',')[0]);
			drawLines(x + radius, 0)
		}

		// https://github.com/wbkd/d3-extended
		d3.selection.prototype.moveToBack = function() {  
			return this.each(function() { 
				var firstChild = this.parentNode.firstChild; 
				if (firstChild) { 
					this.parentNode.insertBefore(this, firstChild); 
				} 
			});
		}
	</script>


	<script>
		var data = [
			{name: 'About', color: '#EC644B'},
			{name: 'Programming', color: '#86E2D5'},
			{name: 'Photography', color: '#66CC99'},
			{name: 'Music', color: '#FFCC80'},
			{name: 'Astronomy', color: '#AED581'},
			{name: 'Contact', color: '#BE90D4'}
		];

		//size and margin
		var radius = 30,
		gap = 45,
		topMargin = 25,
		leftPadding = 100,
		basewidth = (radius*2)*6 + gap*5 + leftPadding*2,
		baseheight = topMargin*2 + radius*2,
		margin = {
			top: radius+topMargin,
			right: 0,
			bottom: 0,
			left:0//radius 
		},
		width = basewidth - margin.left - margin.right,
		height = baseheight - margin.top - margin.bottom;

		// main canvas
		var svg = d3.select('.graph')
		    .append('svg')
		    .attr('width', width + margin.left + margin.right)
		    .attr('height', height + margin.top + margin.bottom)
			// .on("click", function(d, i) {
			// 	active = -1;	
			// });
		var canvas = svg.append("g")
		    .attr("class", "margin")
		    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")	

		var menu = canvas.append('g')
			.attr('class', 'menu')
			.style('opacity', 0.75)
		    .attr("transform", "translate(" + radius + ",0)")	

		var button = menu.selectAll('.class')
			.data(data)
			.enter()
			.append('g')
			.attr('class', 'button')
			.attr('id', function(d, i) {
				return 'btn' + i;
			})
			.style('opacity', 0)
			.attr("transform", function(d, i) {
				return "translate(" + (leftPadding+((radius*2 + gap)*i)) + "," + radius*2 + ")"
			});

		button
			.append('circle')
			.attr('r', radius)
			.attr('fill', function(d, i) {
				return d.color;
			});

		button
			.on("mouseenter", hoverEnter)
			.on("mouseleave", hoverLeave)	
			.on("click", buttonClick)

		button
			.transition()
			.delay( function(d, i) {
				return 1000 + 100*i;
			})
			.duration(1200)
			.ease(d3.easeElastic)
			.style('opacity', 1)
			.attr("transform", function(d, i) {
				return "translate(" + (leftPadding+((radius*2 + gap)*i)) + "," + 0 + ")"
			});
	</script>
</body>
</html>
